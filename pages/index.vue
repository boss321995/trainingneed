<template>
  <div class="min-h-screen bg-white">
    <div class="relative">
      <div class="pointer-events-none absolute inset-x-0 top-0 flex justify-center">
        <div class="h-48 w-full max-w-6xl bg-gradient-to-r from-blue-200 via-indigo-200 to-purple-200 blur-3xl opacity-40"></div>
      </div>
      <div class="relative max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8 space-y-10">
        <section class="bg-white border border-gray-100 rounded-3xl shadow-sm overflow-hidden">
          <div class="h-1 bg-gradient-to-r from-blue-500 via-indigo-500 to-purple-500"></div>
          <div class="p-6 sm:p-8 lg:p-10">
            <div class="grid gap-10 lg:grid-cols-[2fr,1fr] xl:grid-cols-[3fr,2fr]">
              <div class="space-y-6">
                <div class="space-y-3">
                  <span class="inline-flex items-center gap-2 rounded-full bg-blue-50 px-3 py-1 text-xs font-semibold text-blue-700">
                    <span class="h-2 w-2 rounded-full bg-blue-500"></span>
                    ‡∏£‡∏∞‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ
                  </span>
                  <h1 class="text-3xl sm:text-4xl font-semibold text-gray-900 leading-tight">
                    ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ
                  </h1>
                  <p class="text-base sm:text-lg text-gray-600 leading-relaxed">
                    ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö {{ user?.fullname || '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' }} ‚Äî ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ú‡∏ô‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°‡πÉ‡∏´‡πâ‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏¢‡∏∏‡∏ó‡∏ò‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
                  </p>
                </div>
                <div class="flex flex-wrap items-center gap-3">
                  <div
                    v-if="accessRole === 'assigned' && assignmentInfo"
                    class="inline-flex items-center gap-2 rounded-full border border-emerald-200 bg-emerald-50 px-4 py-2 text-sm text-emerald-700"
                  >
                    <span class="text-base">ü§ù</span>
                    <span>‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏à‡∏≤‡∏Å {{ assignmentInfo.name }} ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÅ‡∏ú‡∏ô‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°</span>
                  </div>
                  <div
                    v-if="isManager"
                    class="inline-flex items-center gap-2 rounded-full border border-blue-200 bg-blue-50 px-4 py-2 text-sm text-blue-700"
                  >
                    <span class="text-base">üéØ</span>
                    <span>‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏≤‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏ß‡∏ô ‡∏î‡∏π‡πÅ‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÅ‡∏ú‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏ó‡∏µ‡∏°</span>
                  </div>
                  <div
                    v-else
                    class="inline-flex items-center gap-2 rounded-full border border-indigo-200 bg-indigo-50 px-4 py-2 text-sm text-indigo-700"
                  >
                    <span class="text-base">üìö</span>
                    <span>‡∏ú‡∏π‡πâ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°</span>
                  </div>
                </div>
                <div class="grid gap-3 sm:grid-cols-2 lg:grid-cols-3">
                  
                  <NuxtLink
                    to="/my-requests"
                    class="group flex items-center justify-between rounded-2xl border border-blue-100 bg-blue-50/70 px-4 py-3 text-sm font-medium text-blue-700 transition hover:border-blue-200 hover:bg-blue-100"
                  >
                    <span>‡∏î‡∏π‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡πà‡∏ß‡∏ô</span>
                    <span class="text-lg opacity-0 transition group-hover:opacity-100">‚Üí</span>
                  </NuxtLink>
                  <button
                    type="button"
                    @click="showProfile = true"
                    class="group flex items-center justify-between rounded-2xl border border-purple-100 bg-purple-50/70 px-4 py-3 text-sm font-medium text-purple-700 transition hover:border-purple-200 hover:bg-purple-100"
                  >
                    <span>‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</span>
                    <span class="text-lg opacity-0 transition group-hover:opacity-100">‚Üí</span>
                  </button>
                </div>
              </div>
              <div class="space-y-6">
                <div class="rounded-2xl border border-blue-100 bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-6 shadow-inner">
                  <div class="flex items-center gap-3">
                    <div class="flex h-12 w-12 items-center justify-center rounded-xl bg-white shadow-sm">
                      <span class="text-2xl text-indigo-600">üë§</span>
                    </div>
                    <div>
                      <p class="text-sm font-semibold text-indigo-700 uppercase tracking-wide">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
                      <p class="text-lg font-semibold text-gray-900">{{ user?.fullname || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏ä‡∏∑‡πà‡∏≠' }}</p>
                      <p class="text-sm text-gray-600">{{ user?.position || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á' }}</p>
                    </div>
                  </div>
                  <dl class="mt-5 space-y-3 text-sm text-gray-600">
                    <div class="flex items-center justify-between gap-4">
                      <dt class="text-gray-500">‡∏™‡πà‡∏ß‡∏ô‡∏á‡∏≤‡∏ô</dt>
                      <dd class="text-right font-medium text-gray-900">{{ user?.section || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡πà‡∏ß‡∏ô‡∏á‡∏≤‡∏ô' }}</dd>
                    </div>
                    <div class="flex items-center justify-between gap-4">
                      <dt class="text-gray-500">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</dt>
                      <dd class="text-right font-medium text-gray-900">{{ user?.department || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô' }}</dd>
                    </div>
                    <div class="flex items-center justify-between gap-4">
                      <dt class="text-gray-500">‡∏£‡∏∞‡∏î‡∏±‡∏ö</dt>
                      <dd class="text-right font-medium text-gray-900">{{ user?.level || '-' }}</dd>
                    </div>
                    <div class="flex items-center justify-between gap-4">
                      <dt class="text-gray-500">‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</dt>
                      <dd class="text-right font-medium text-gray-900">{{ user?.role || '-' }}</dd>
                    </div>
                  </dl>
                  <div class="mt-6 grid gap-2 text-xs text-gray-500">
                    <div class="flex items-center gap-2">
                      <span class="h-2 w-2 rounded-full bg-emerald-500"></span>
                      <span>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏∞‡∏ö‡∏ö: {{ authReady ? '‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' : '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...' }}</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <span class="h-2 w-2 rounded-full bg-indigo-500"></span>
                      <span>‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: {{ accessRole || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' }}</span>
                    </div>
                  </div>
                </div>
                <button
                  v-if="!showProfile"
                  @click="showProfile = true"
                  type="button"
                  class="w-full rounded-2xl border border-gray-200 bg-white px-4 py-3 text-sm font-medium text-gray-700 shadow-sm transition hover:border-indigo-200 hover:text-indigo-600"
                >
                  ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
                </button>
              </div>
            </div>
          </div>
        </section>

      

        <section class="space-y-6">
          <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
            <div>
              <h2 class="text-2xl font-semibold text-gray-900">‡πÄ‡∏°‡∏ô‡∏π‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏Å</h2>
              <p class="text-sm text-gray-500">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÉ‡∏´‡∏°‡πà ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
            </div>
            <span v-if="trainingPlanLoading" class="inline-flex items-center gap-2 rounded-full bg-amber-50 px-3 py-1 text-xs font-medium text-amber-600">
              <svg class="h-4 w-4 animate-spin" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6l4 2" />
              </svg>
              ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏ú‡∏ô‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°
            </span>
          </div>

          <div class="grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3">
            <!-- Training Plan Management Card -->
            <div class="bg-white border border-gray-100 rounded-2xl shadow-sm hover:shadow-md transition">
              <div class="p-6 flex flex-col h-full">
                <div class="flex items-start gap-4">
                  <div class="flex h-12 w-12 items-center justify-center rounded-xl bg-gradient-to-br from-indigo-50 to-purple-50 text-indigo-600 shadow-sm">
                    <svg class="h-7 w-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                    </svg>
                  </div>
                  <div class="space-y-1">
                    <p class="text-xs font-semibold uppercase tracking-wide text-indigo-500">{{ isManager ? '‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏á‡∏≤‡∏ô' : '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô' }}</p>
                    <h3 class="text-xl font-semibold text-gray-900 leading-snug">
                      {{ isManager ? '‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ' : '‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°' }}
                    </h3>
                    <p class="text-sm text-gray-500 max-w-sm">
                      {{ isManager ? '‡∏™‡∏£‡∏∏‡∏õ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏≠‡∏ö‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡πÉ‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß' : '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏û‡πá‡∏Ñ‡πÄ‡∏Å‡∏à‡πÅ‡∏•‡∏∞‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏≠‡∏ö‡∏£‡∏°' }}
                    </p>
                  </div>
                </div>

                <div class="mt-6 flex-1 flex flex-col">
                  <button
                    :disabled="hasSubmittedTrainingPlan"
                    @click="goToTrainingPlan"
                    type="button"
                    class="inline-flex items-center justify-center rounded-xl px-5 py-3 text-sm font-semibold text-white shadow-sm transition focus:outline-none focus:ring-2 focus:ring-offset-2"
                    :class="hasSubmittedTrainingPlan
                      ? 'bg-gray-200 text-gray-500 cursor-not-allowed focus:ring-gray-200'
                      : 'bg-gradient-to-r from-indigo-500 via-purple-500 to-indigo-600 hover:from-indigo-600 hover:via-purple-600 hover:to-indigo-700 focus:ring-indigo-500'"
                  >
                    <span class="mr-2 text-lg">{{ isManager ? 'üéØ' : 'üìù' }}</span>
                    <span class="tracking-wide">{{ isManager ? '‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÅ‡∏ú‡∏ô‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°' : '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏£‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°' }}</span>
                  </button>

                  <div v-if="hasSubmittedTrainingPlan" class="mt-3 rounded-lg bg-amber-50 border border-amber-200 px-3 py-2 text-xs text-amber-800">
                    ‚úÖ ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÅ‡∏ú‡∏ô‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°‡πÅ‡∏•‡πâ‡∏ß ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ ‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÄ‡∏°‡∏ô‡∏π <strong>"‡πÅ‡∏ú‡∏ô‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô"</strong>
                  </div>
                </div>
              </div>
            </div>

            <!-- Team Management Card (Manager only) -->
            <div v-if="isManager" class="bg-white border border-gray-100 rounded-2xl shadow-sm hover:shadow-md transition">
              <div class="p-6 flex h-full flex-col">
                <div class="flex items-start gap-4">
                  <div class="flex h-12 w-12 items-center justify-center rounded-xl bg-gradient-to-br from-purple-50 to-indigo-50 text-purple-600 shadow-sm">
                    <svg class="h-7 w-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                  </div>
                  <div class="space-y-1">
                    <p class="text-xs font-semibold uppercase tracking-wide text-purple-500">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡∏°</p>
                    <h3 class="text-xl font-semibold text-gray-900 leading-snug">‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ï‡πâ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏≤‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÅ‡∏ú‡∏ô‡∏Ç‡∏≠‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°</h3>
                    <p class="text-sm text-gray-500">‡∏£‡∏∞‡∏ö‡∏∏‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÅ‡∏ú‡∏ô</p>
                  </div>
                </div>
                <NuxtLink
                  to="/team-management"
                  class="mt-6 inline-flex items-center justify-center rounded-xl border border-transparent bg-gradient-to-r from-purple-500 to-indigo-500 px-5 py-3 text-sm font-semibold text-white shadow-sm transition hover:from-purple-600 hover:to-indigo-600"
                >
                  üë• ‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ï‡πâ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏≤‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÅ‡∏ú‡∏ô‡∏Ç‡∏≠‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°
                </NuxtLink>
              </div>
            </div>

            <!-- My Training Status Card -->
            <div class="bg-white border border-gray-100 rounded-2xl shadow-sm hover:shadow-md transition">
              <div class="p-6 flex h-full flex-col">
                <div class="flex items-start gap-4">
                  <div class="flex h-12 w-12 items-center justify-center rounded-xl bg-gradient-to-br from-blue-50 to-cyan-50 text-blue-600 shadow-sm">
                    <svg class="h-7 w-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                  </div>
                  <div class="space-y-1">
                    <p class="text-xs font-semibold uppercase tracking-wide text-blue-500">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏ú‡∏ô</p>
                    <h3 class="text-xl font-semibold text-gray-900 leading-snug">{{ isManager ? '‡∏î‡∏π‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡πà‡∏ß‡∏ô' : '‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡πÅ‡∏ú‡∏ô‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°' }}</h3>
                    <p class="text-sm text-gray-500">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                  </div>
                </div>
                <NuxtLink
                  to="/my-requests"
                  class="mt-6 inline-flex items-center justify-center rounded-xl border border-transparent bg-gradient-to-r from-blue-500 to-indigo-500 px-5 py-3 text-sm font-semibold text-white shadow-sm transition hover:from-blue-600 hover:to-indigo-600"
                >
                  {{ isManager ? 'üìä ‡∏î‡∏π‡πÅ‡∏ú‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏á‡∏≤‡∏ô' : 'üìã ‡∏î‡∏π‡πÅ‡∏ú‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô' }}
                </NuxtLink>
              </div>
            </div>

            <!-- Reports Card (Authorized sections only) -->
            <div v-if="canViewOrgReport" class="bg-white border border-gray-100 rounded-2xl shadow-sm hover:shadow-md transition">
              <div class="p-6 flex h-full flex-col">
                <div class="flex items-start gap-4">
                  <div class="flex h-12 w-12 items-center justify-center rounded-xl bg-gradient-to-br from-emerald-50 to-teal-50 text-emerald-600 shadow-sm">
                    <svg class="h-7 w-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                  </div>
                  <div class="space-y-1">
                    <p class="text-xs font-semibold uppercase tracking-wide text-emerald-500">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</p>
                    <h3 class="text-xl font-semibold text-gray-900 leading-snug">{{ user?.role === 'hrd_admin' ? '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£' : '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÅ‡∏ú‡∏ô‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°' }}</h3>
                    <p class="text-sm text-gray-500">‡∏î‡∏π‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏° ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
                  </div>
                </div>
                <NuxtLink
                  to="/reports"
                  class="mt-6 inline-flex items-center justify-center rounded-xl border border-transparent bg-gradient-to-r from-emerald-500 to-teal-500 px-5 py-3 text-sm font-semibold text-white shadow-sm transition hover:from-emerald-600 hover:to-teal-600"
                >
                  ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
                </NuxtLink>
              </div>
            </div>

            <!-- Profile Card -->
            <div class="bg-white border border-gray-100 rounded-2xl shadow-sm hover:shadow-md transition">
              <div class="p-6 flex h-full flex-col">
                <div class="flex items-start gap-4">
                  <div class="flex h-12 w-12 items-center justify-center rounded-xl bg-gradient-to-br from-purple-50 to-pink-50 text-purple-600 shadow-sm">
                    <svg class="h-7 w-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                  </div>
                  <div class="space-y-1">
                    <p class="text-xs font-semibold uppercase tracking-wide text-purple-500">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</p>
                    <h3 class="text-xl font-semibold text-gray-900 leading-snug">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</h3>
                    <p class="text-sm text-gray-500">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÅ‡∏ú‡∏ô</p>
                  </div>
                </div>
                <button
                  @click="showProfile = !showProfile"
                  class="mt-6 inline-flex items-center justify-center rounded-xl border border-transparent bg-gradient-to-r from-purple-500 to-indigo-500 px-5 py-3 text-sm font-semibold text-white shadow-sm transition hover:from-purple-600 hover:to-indigo-600"
                >
                  {{ showProfile ? '‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•' : '‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•' }}
                </button>
              </div>
            </div>

            <!-- Logout Card -->
            <div class="bg-white border border-gray-100 rounded-2xl shadow-sm hover:shadow-md transition">
              <div class="p-6 flex h-full flex-col">
                <div class="flex items-start gap-4">
                  <div class="flex h-12 w-12 items-center justify-center rounded-xl bg-gradient-to-br from-rose-50 to-orange-50 text-rose-600 shadow-sm">
                    <svg class="h-7 w-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                    </svg>
                  </div>
                  <div class="space-y-1">
                    <p class="text-xs font-semibold uppercase tracking-wide text-rose-500">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</p>
                    <h3 class="text-xl font-semibold text-gray-900 leading-snug">Logout</h3>
                    <p class="text-sm text-gray-500">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</p>
                  </div>
                </div>
                <button
                  @click="logout"
                  class="mt-6 inline-flex items-center justify-center rounded-xl border border-transparent bg-gradient-to-r from-rose-500 to-red-500 px-5 py-3 text-sm font-semibold text-white shadow-sm transition hover:from-rose-600 hover:to-red-600"
                >
                  ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                </button>
              </div>
            </div>
          </div>
        </section>

        <section v-if="showProfile && user" class="bg-white border border-gray-100 rounded-3xl shadow-sm">
          <div class="px-6 py-6 sm:px-8 sm:py-8">
            <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
              <h3 class="text-xl font-semibold text-gray-900">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</h3>
              <span class="inline-flex items-center gap-2 rounded-full bg-indigo-50 px-3 py-1 text-xs font-medium text-indigo-600">
                <span class="h-2 w-2 rounded-full bg-indigo-500"></span>
                ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
              </span>
            </div>
            <div class="mt-6 grid grid-cols-1 gap-6 md:grid-cols-2">
              <div>
                <dt class="text-sm font-medium text-gray-500">‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</dt>
                <dd class="mt-1 text-sm font-semibold text-gray-900">{{ user.employee_id }}</dd>
              </div>
              <div>
                <dt class="text-sm font-medium text-gray-500">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</dt>
                <dd class="mt-1 text-sm font-semibold text-gray-900">{{ user.fullname }}</dd>
              </div>
              <div>
                <dt class="text-sm font-medium text-gray-500">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</dt>
                <dd class="mt-1 text-sm font-semibold text-gray-900">{{ user.position }}</dd>
              </div>
              <div>
                <dt class="text-sm font-medium text-gray-500">‡∏£‡∏∞‡∏î‡∏±‡∏ö</dt>
                <dd class="mt-1 text-sm font-semibold text-gray-900">{{ user.level }}</dd>
              </div>
              <div>
                <dt class="text-sm font-medium text-gray-500">‡∏™‡πà‡∏ß‡∏ô‡∏á‡∏≤‡∏ô</dt>
                <dd class="mt-1 text-sm font-semibold text-gray-900">{{ user.section }}</dd>
              </div>
              <div>
                <dt class="text-sm font-medium text-gray-500">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</dt>
                <dd class="mt-1 text-sm font-semibold text-gray-900">{{ user.department }}</dd>
              </div>
              <div>
                <dt class="text-sm font-medium text-gray-500">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</dt>
                <dd class="mt-1 text-sm font-semibold text-gray-900">{{ user.email }}</dd>
              </div>
              <div>
                <dt class="text-sm font-medium text-gray-500">‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</dt>
                <dd class="mt-1">
                  <span
                    class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium"
                    :class="{
                      'bg-green-100 text-green-800': user.role === 'hrd_admin',
                      'bg-blue-100 text-blue-800': user.role === 'manager',
                      'bg-gray-100 text-gray-800': user.role === 'user'
                    }"
                  >
                    {{ user.role === 'hrd_admin' ? '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö HRD' : user.role === 'manager' ? '‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£' : '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô' }}
                  </span>
                </dd>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>
</template>

<script setup>
import { useAuthStore } from '~/stores/auth'

definePageMeta({
  middleware: 'auth'
})

const authStore = useAuthStore()
const user = computed(() => authStore.user)
const accessRole = computed(() => authStore.accessRole)
const assignmentInfo = computed(() => authStore.assignmentInfo)
const showProfile = ref(false)
const authReady = ref(authStore.isInitialized)
const hasSubmittedTrainingPlan = ref(false)
const trainingPlanLoading = ref(false)

// Check if user is a manager (Level 8 or higher)  
const isManager = computed(() => {
  return user.value && user.value.level >= 8
})

const sectionCode = computed(() => {
  const candidateSources = [
    user.value?.section_full_code,
    user.value?.sectionFullCode,
    user.value?.section_code,
    user.value?.sectionCode,
    user.value?.section,
    user.value?.department_short,
    user.value?.departmentShort
  ]

  for (const candidate of candidateSources) {
    if (candidate === null || candidate === undefined) {
      continue
    }

    const value = typeof candidate === 'string' ? candidate.trim() : String(candidate)
    if (value.length > 0) {
      return value
    }
  }

  return ''
})

const canViewOrgReport = computed(() => {
  if (user.value?.role === 'hrd_admin') {
    return true
  }
  const digits = sectionCode.value.replace(/[^0-9]/g, '')
  if (!digits) {
    return false
  }
  return digits.includes('0010332601')
})

onMounted(async () => {
  if (!authStore.isInitialized) {
    await authStore.initializeAuth()
  }
  authReady.value = true
  await checkTrainingPlanStatus()
})

watch(
  () => authStore.isInitialized,
  (initialized) => {
    if (initialized) {
      authReady.value = true
    }
  },
  { immediate: true }
)

watch(user, async (newUser, oldUser) => {
  if (newUser && newUser !== oldUser) {
    await checkTrainingPlanStatus()
  }
})

const checkTrainingPlanStatus = async () => {
  if (!authStore.isAuthenticated) {
    hasSubmittedTrainingPlan.value = false
    return
  }

  try {
    trainingPlanLoading.value = true
    const response = await fetch('http://localhost:4001/api/training-needs/plan-status', {
      credentials: 'include'
    })

    if (!response.ok) {
      throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏ú‡∏ô‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°‡πÑ‡∏î‡πâ')
    }

    const data = await response.json()
    hasSubmittedTrainingPlan.value = !!data?.hasSubmitted
  } catch (error) {
    console.error('Failed to check training plan status:', error)
    hasSubmittedTrainingPlan.value = false
  } finally {
    trainingPlanLoading.value = false
  }
}

const goToTrainingPlan = () => {
  if (hasSubmittedTrainingPlan.value) {
    return
  }
  navigateTo('/training/new')
}

const logout = async () => {
  await authStore.logout()
  navigateTo('/login')
}
</script>
